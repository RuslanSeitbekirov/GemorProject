# version: '3.8'

# services:
#   postgres:
#     container_name: test-system-db
#     image: postgres:15-alpine
#     environment:
#       POSTGRES_USER: postgres
#       POSTGRES_PASSWORD: 12345
#       POSTGRES_DB: test_system
#     ports:
#       - "5438:5432"
#     volumes:
#       - postgres-data:/var/lib/postgresql/data
#     networks:
#       - app-network

#   redis:
#     container_name: test-system-redis
#     image: redis:alpine
#     command: redis-server --requirepass redis123
#     ports:
#       - "6379:6379"
#     volumes:
#       - redis-data:/data
#     networks:
#       - app-network

#   web-client:
#     container_name: test-system-app
#     image: node:18-alpine
#     working_dir: /app
#     volumes:
#       - ./public:/app/public
#       - ./package.json:/app/package.json
#       - ./package-lock.json:/app/package-lock.json
#       - ./server.js:/app/server.js
#     ports:
#       - "3000:3000"
#     environment:
#       NODE_ENV: development
#       DB_HOST: postgres
#       DB_PORT: 5432
#       DB_USER: postgres
#       DB_PASSWORD: 12345
#       DB_NAME: test_system
#       REDIS_HOST: redis
#       REDIS_PORT: 6379
#       REDIS_PASSWORD: redis123
#       JWT_SECRET: your-super-secret-jwt-key-1234567890
#       SESSION_SECRET: your-session-secret-key-987654321
#     command: >
#       sh -c "
#         echo 'Installing dependencies...' &&
#         npm install &&
#         echo 'Starting server...' &&
#         node server.js
#       "
#     depends_on:
#       - postgres
#       - redis
#     networks:
#       - app-network

# volumes:
#   postgres-data:
#   redis-data:

# networks:
#   app-network:
#     driver: bridge

version: '3.8'

services:
  web:
    image: node:18-alpine
    container_name: test-system-web
    working_dir: /app
    volumes:
      - ./public:/app/public
      - ./package.json:/app/package.json
      - ./package-lock.json:/app/package-lock.json
      - ./server.js:/app/server.js
    ports:
      - "3000:3000"
    environment:
      DB_HOST: host.docker.internal  # Для доступа к хосту из контейнера
      DB_PORT: 5438
      DB_USER: postgres
      DB_PASSWORD: 12345
      DB_NAME: test_system
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: >
      sh -c "
        echo 'Installing dependencies...' &&
        npm install &&
        echo 'Starting server...' &&
        node server.js
      "